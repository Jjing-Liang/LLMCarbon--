name: llm traing basic manifest
description:
  "
  a basic llm manifest
  training-operation-carbon: Wh = GPU-h×(GPU power consumption)×PUE and tCO2eq = MWh × Impact
  training-embodied-carbon: training days / hardware lifetime * (hardware num × hardware CPA)
  "
tags:
initialize:
  plugins:
    training-operation-carbon-multiply:
      method: Multiply
      path: '@grnsft/if-plugins'
      global-config:
        input-parameters: ['resources-reserved', 'gpu/duration', 'gpu/powerConsumption', 'pue', 'carbonImpact']
        output-parameter: 'operation-carbon'
    device-expected-lifespan-hours-per-year-multiply:
      method: Multiply
      path: '@grnsft/if-plugins'
      global-config:
        input-parameters: ['device/expected-lifespan', 'days-per-year', 'hours-per-day']
        output-parameter: 'expected-lifespan-duration'
    reserved-device-hour-with-device-expected-lifespan-divide:
      method: Divide
      path: '@grnsft/if-plugins'
      global-config:
        numerator: 'gpu/duration'
        denominator: 'expected-lifespan-duration'
        output: 'expected-lifespan-rate'
    embodied-carbon-multiply:
      method: Multiply
      path: '@grnsft/if-plugins'
      global-config:
        input-parameters: ['resources-reserved', 'expected-lifespan-rate','device/emissions-embodied', 'thousands-per-unit']
        output-parameter: 'carbon-embodied'
    sum:
      method: Sum
      path: '@grnsft/if-plugins'
      global-config:
        input-parameters: [ 'operation-carbon', 'carbon-embodied' ]
        output-parameter: 'total-carbon'
tree:
  children:
    child:
      pipeline:
        - training-operation-carbon-multiply
        - device-expected-lifespan-hours-per-year-multiply
        - reserved-device-hour-with-device-expected-lifespan-divide
        - embodied-carbon-multiply
        - sum
      defaults:
        thousands-per-unit: 0.001
        days-per-year: 365
        hours-per-day: 24
        seconds-per-hour: 3600
        device/emissions-embodied: 1533.120 # in gCO2e for total resource units
        device/expected-lifespan: 5 # 5 years in seconds.
        # Meta’s data centers achieve an average utilization rate of 60% throughout the 5-year lifespan of hardware units
        # ref: Carole-Jean Wu, Ramya Raghavendra, Udit Gupta, Bilge Acun, Newsha Ardalani, Kiwan Maeng, Gloria Chang, Fiona Aga, Jinshi Huang, Charles Bai, et al. Sustainable ai: Environmental impli- cations, challenges and opportunities. Proceedings of Machine Learning and Systems, 4:795–813, 2022.
        resources-reserved: 1 # resource units reserved / used
      inputs:
        - timestamp: 2023-08-06T00:00
          gpu/powerConsumption: 400 # kWh
          gpu/duration: 82432 # hour
          hardware/CPA: 1533.120
          pue: 1.1
          carbonImpact: 0.385 # the US national average carbon intensity factor of 0.385 kg CO2eq/KWh
